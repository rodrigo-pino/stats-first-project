---
title: "R Notebook"
output: html_notebook
---

Se genera la poblacion inicial y se extraen 4 muestras sin remplazo. Cada una de tamanno 200, 60, 30 y 20. Luego se extraen otras 4 de igual tamanno a las anteriores, pero esta vez con remplazo.


```{r}
population <- rnorm(500)

large_sample <- sample(population, 200, replace = FALSE)
large_sample_replace <- sample(population, 200, replace = TRUE)

big_sample <- sample(population, 60, replace = FALSE)
big_sample_replace <- sample(population, 60, replace = TRUE)

medium_sample <- sample(population, 30, replace = FALSE)
medium_sample_replace <- sample(population, 30, replace = TRUE)

small_sample <- sample(population, 20, replace = FALSE)
small_sample_replace <- sample(population, 20, replace = TRUE)
```

Se calculan los estadisticos descriptivos de las muestras y la poblacion para su posterior analisis.

```{r}
large_sample_mean <- mean(large_sample)
large_sample_replace_mean <- mean(large_sample_replace)

big_sample_mean <- mean(big_sample)
big_sample_replace_mean <- mean(big_sample_replace)

medium_sample_mean <- mean(medium_sample)
medium_sample_replace_mean <- mean(medium_sample_replace)

small_sample_mean <- mean(small_sample)
small_sample_replace_mean <- mean(small_sample_replace)

population_mean <- mean(population)


large_sample_mode <- mode(large_sample)
large_sample_replace_mode <- mode(large_sample_replace)

big_sample_mode <- mode(big_sample)
big_sample_replace_mode <- mode(big_sample_replace)

medium_sample_mode <- mode(medium_sample)
medium_sample_replace_mode <- mode(medium_sample_replace)

small_sample_mode <- mode(small_sample)
small_sample_replace_mode <- mode(small_sample_replace)

population_mode <- mode(population)


large_sample_median <- median(large_sample)
large_sample_replace_median <- median(large_sample_replace)

big_sample_median <- median(big_sample)
big_sample_replace_median <- median(big_sample_replace)

medium_sample_median <- median(medium_sample)
medium_sample_replace_median <- median(medium_sample_replace)

small_sample_median <- median(small_sample)
small_sample_replace_median <- median(small_sample_replace)

population_median <- median(population)


large_sample_var <- var(large_sample)
large_sample_replace_var <- var(large_sample_replace)

big_sample_var <- var(big_sample)
big_sample_replace_var <- var(big_sample_replace)

medium_sample_var <- var(medium_sample)
medium_sample_replace_var <- var(medium_sample_replace)

small_sample_var <- var(small_sample)
small_sample_replace_var <- var(small_sample_replace)

population_var <- var(population)

large_sample_sd <- sd(large_sample)
large_sample_replace_sd <- sd(large_sample_replace)

big_sample_sd <- sd(big_sample)
big_sample_replace_sd <- sd(big_sample_replace)

medium_sample_sd <- sd(medium_sample)
medium_sample_replace_sd <- sd(medium_sample_replace)

small_sample_sd <- sd(small_sample)
small_sample_replace_sd <- sd(small_sample_replace)

population_sd <- sd(population)
```

Los estadisticos descriptivos de las 8 muestras estuvieran cerca de los de la poblacion. La diferencia mayor entre las muestras y la poblacion durante nuestras pruebas no supero las 0,2 decimas.

Debido a su caracter probabilistico, el metodo de extraccion de las muestras afecta directamente al resultado de las medidas de tendencia central y dispersion. Como consecuancia las muestras de mayor tamanno tienen mayor probabilildad de que sus estimadores puntuales esten mas cercanos al valor real pues se reduce la probabilidad de tener en la muestra casos extremos que no son representativos de la poblacion, y cuando estos estan en la muestra su impacto es suavizado por la cantidad de caso no extremos. Por esta misma razon las muestras de menor tamanno suelen dar resultados mas alejados de la realidad.

Las muestras que se extrajeron con remplazo durante nuestros experimentos sus estimadores puntuales son mas exactos en las muestras de menor tamanno, no obstante esto no ocurrio consistentemente.

```{r}
# Ver diferencia entre las medidas de dispersion utilizadas
get_diff <- function(word, sample_val, population_val) {
    dif <- abs(population_val - sample_val)
    output <- paste("The", 
                    word, 
                    "differs from the population in",
                    format(dif, digits = 3)
    )
    print(output)
}

print("For large sample (n = 200) without replacement")
get_diff("mean", large_sample_mean, population_mean)
get_diff("median", large_sample_median, population_median)
#get_diff("mode", large_sample_mode, population_mode)
get_diff("variance", large_sample_var, population_var)
get_diff("standard deviation", large_sample_sd, population_sd)

print("")
print("For large sample (n = 200) with replacement")
get_diff("mean", large_sample_replace_mean, population_mean)
get_diff("median", large_sample_replace_median, population_median)
#get_diff("mode", large_sample_replace_mode, population_mode)
get_diff("variance", large_sample_replace_var, population_var)
get_diff("standard deviation", large_sample_replace_sd, population_sd)

print("")
print("For big sample (n = 60) without replacement")
get_diff("mean", big_sample_mean, population_mean)
get_diff("median", big_sample_median, population_median)
#get_diff("mode", big_sample_mode, population_mode)
get_diff("variance", big_sample_var, population_var)
get_diff("standard deviation", big_sample_sd, population_sd)

print("")
print("For big sample (n = 60) with replacement")
get_diff("mean", big_sample_replace_mean, population_mean)
get_diff("median", big_sample_replace_median, population_median)
#get_diff("mode", big_sample_replace_mode, population_mode)
get_diff("variance", big_sample_replace_var, population_var)
get_diff("standard deviation", big_sample_replace_sd, population_sd)

print("")
print("For medium sample (n = 30) without replacement")
get_diff("mean", medium_sample_mean, population_mean)
get_diff("median", medium_sample_median, population_median)
#get_diff("mode", medium_sample_mode, population_mode)
get_diff("variance", medium_sample_var, population_var)
get_diff("standard deviation", medium_sample_sd, population_sd)

print("")
print("For medium sample (n = 30) with replacement")
get_diff("mean", medium_sample_replace_mean, population_mean)
get_diff("median", medium_sample_replace_median, population_median)
#get_diff("mode", medium_sample_replace_mode, population_mode)
get_diff("variance", medium_sample_replace_var, population_var)
get_diff("standard deviation", medium_sample_replace_sd, population_sd)

print("")
print("For small sample (n = 20) without replacement")
get_diff("mean", small_sample_mean, population_mean)
get_diff("median", small_sample_median, population_median)
#get_diff("mode", small_sample_mode, population_mode)
get_diff("variance", small_sample_var, population_var)
get_diff("standard deviation", small_sample_sd, population_sd)

print("")
print("For small sample (n = 20) with replacement")
get_diff("mean", small_sample_replace_mean, population_mean)
get_diff("median", small_sample_replace_median, population_median)
#get_diff("mode", small_sample_replace_mode, population_mode)
get_diff("variance", small_sample_replace_var, population_var)
get_diff("standard deviation", small_sample_replace_sd, population_sd)

```

Utilizamos un grafico de cajas y bigotes en paralelo sobre las ocho muestras y la poblacion para tener una imagen de como se comportan los datos de manera general.

l: large (n = 200)
b: big (n = 60)
m: medium (n = 30)
s: small (n = 20)
p: population

Es posbile apreciar que las cajas estan por lo general alineadas y bien formadas, lo que muestra que se mantiene la distibucion normal entre los datos de la muestras y los valores se encuentran bien centrados. La mayor diferencia entre las muestras se aprecia prinicipalmente en el _lowest hinge_ y el _upper hinge_.

```{r}
values <- c(large_sample, large_sample_replace,
            big_sample, big_sample_replace,
            population,
            medium_sample, medium_sample_replace,
            small_sample, small_sample_replace)
sample_type <- c()
for (i in seq_len(length(large_sample))) {
    sample_type  <- append(sample_type, "l")
}
for (i in seq_len(length(large_sample_replace))) {
    sample_type  <- append(sample_type, "lr")
}
for (i in seq_len(length(big_sample))) {
    sample_type  <- append(sample_type, "b")
}
for (i in seq_len(length(big_sample_replace))) {
    sample_type  <- append(sample_type, "br")
}
for (i in seq_len(length(population))) {
    sample_type  <- append(sample_type, "p")
}
for (i in seq_len(length(medium_sample))) {
    sample_type  <- append(sample_type, "m")
}
for (i in seq_len(length(medium_sample_replace))) {
    sample_type  <- append(sample_type, "mr")
}
for (i in seq_len(length(small_sample))) {
    sample_type  <- append(sample_type, "s")
}
for (i in seq_len(length(small_sample_replace))) {
    sample_type  <- append(sample_type, "sr")
}

df <- data.frame(values, sample_type)

boxplot(values~sample_type,
        data = df,
        xlab = "Sample Types",
        ylab = "Values"
)

```
aaa

```{r}
#aaa
```

Se calculan los intervalos de confianza para la media y la varianza de todas las muestras. Se utiliza un nivel de significacion del 5%. Primero se definen las funciones a utilizar para calcular los intervalos de confianza para la varianza y para la media con n <= 30 y n > 30. 

```{r}

print_mean  <- function(interval, population_mean, alpha) {
    res  <- paste(
                  "With confidence level", 1 - alpha,
                  "population mean is in between (",
                  format(interval[1], digits = 3), ",",
                  format(interval[2], digits = 3), ")",
                  "which is",
                  interval[1] < population_mean | interval[2] > population_mean
    )
    print(res)
}

print_var  <-  function(interval, population_var, alpha) {
    res  <- paste(
                  "With confidence level", 1 - alpha,
                  "population variance is in between (",
                  format(interval[1], digits = 3), ",",
                  format(interval[2], digits = 3), ")",
                  "which is",
                  interval[1] < population_var | interval[2] > population_var
    )
    print(res)

}

get_mean_conf_interval  <-  function(data, population_mean, alpha = 0.05) {
    x <- mean(data)
    s <- sd(data)
    error <- qnorm(1 - alpha / 2) * s / sqrt(length(data))

    interval <- c(x - error, x  + error)
    print_mean(interval, population_mean, alpha)
}

get_variance_conf_interval  <- function(data, population_var, alpha = 0.05) {
    s2 <- var(data)
    n <- length(data)
    error_left  <- qchisq(1 - alpha / 2, df = n - 1)
    error_right  <- qchisq(alpha / 2, df = n - 1)
    num  <-  (n - 1) * s2

    interval <- c(num / error_left, num / error_right)
    print_var(interval, population_var, alpha)
}

get_small_mean_conf_interval  <-
    function(data, population_mean, alpha = 0.05) {
        x <- mean(data)
        s <- sd(data)
        n <- length(data)
        error <- qt(1 - alpha / 2, n - 1) * s / sqrt(n)

        interval <- c(x - error, x  + error)
        print_mean(interval, population_mean, alpha)
    }
```

#### Medias de las muestras

En la muestra mas grande se observa el el intervalo mas pequenno. A medida que el tamanno de la muestra disminuye se hace mas dificil predecir el valor real de la media y el intervalo se hace mas grande. Que las muestras sean con remplazo o no, no afecta el tamanno del intervalo.

```{r}
alpha  <- 0.05
print("Large sample (n = 200) without replacement")
get_mean_conf_interval(large_sample, population_mean, alpha)
print("Large sample (n = 200) with replacement")
get_mean_conf_interval(large_sample_replace, population_mean, alpha)

print("")
print("Big sample (n = 60) without replacement")
get_mean_conf_interval(big_sample, population_mean, alpha)
print("Big sample (n = 60) with replacement")
get_mean_conf_interval(big_sample_replace, population_mean, alpha)

print("")
print("Medium sample (n = 30) without replacement")
get_small_mean_conf_interval(medium_sample, population_mean, alpha)
print("Medium sample (n = 30) with replacement")
get_small_mean_conf_interval(medium_sample_replace, population_mean, alpha)

print("")
print("Small sample (n = 20) without replacement")
get_small_mean_conf_interval(small_sample, population_mean, alpha)
print("Small sample (n = 20) with replacement")
get_small_mean_conf_interval(small_sample_replace, population_mean, alpha)
```
#### Varianza de las muestras
Al igual que en la prueba anterior, las muestras mas grandes presentan el intervalo mas pequenno, no obstante los datos extraidos con remplazo presenta un nivel de varianza mucho menor a sus contrapartes de igual tamanno.

```{r}
alpha  <- 0.05

print("Large sample (n = 200) without replacement")
get_variance_conf_interval(large_sample, population_mean, alpha)
print("Large sample (n = 200) with replacement")
get_variance_conf_interval(large_sample_replace, population_mean, alpha)

print("")
print("Big sample (n = 60) without replacement")
get_variance_conf_interval(big_sample, population_mean, alpha)
print("Big sample (n = 60) with replacement")
get_variance_conf_interval(big_sample_replace, population_mean, alpha)

print("")
print("Medium sample (n = 30) without replacement")
get_variance_conf_interval(medium_sample, population_mean, alpha)
print("Medium sample (n = 30) with replacement")
get_variance_conf_interval(medium_sample_replace, population_mean, alpha)

print("")
print("Small sample (n = 20) without replacement")
get_variance_conf_interval(small_sample, population_mean, alpha)
print("Small sample (n = 20) with replacement")
get_variance_conf_interval(small_sample_replace, population_mean, alpha)
```

